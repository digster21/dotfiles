
# Helpful tmux resource
# https://github.com/rothgar/awesome-tmux

# =============================================================================
# GENERAL SETTINGS
# =============================================================================

set -g default-terminal "tmux-256color"
set -g history-limit 10000
set -g mouse on
set -g escape-time 0
set -g base-index 1
set -g pane-base-index 1
set -g renumber-window on

# Use VIM style copy mode 
setw -g mode-key vi

# =============================================================================
# PREFIX SETTINGS
# =============================================================================

set -g prefix2 C-a
bind C-a send-prefix # for nested apps using same binding - double press

# =============================================================================
# RELOAD CONFIG
# =============================================================================

# Reload config file (r is also bound to redraw - intentional choice) 
bind R source-file ~/.config/tmux/tmux.conf

# =============================================================================
# PANE NAVIGATION
# =============================================================================

# Nav panes like vim (default: arrow keys)
bind h select-pane -L # Left 
bind j select-pane -D # Down
bind k select-pane -U # Up
bind l select-pane -R # Right

# =============================================================================
# WINDOW MANAGEMENT
# =============================================================================

# When creating new panes/windows, use the current path
bind c new-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"

# =============================================================================
# PLUGINS
# =============================================================================

# Setup Tmux plugin manager (TPM) [https://github.com/tmux-plugins/tpm]
set -g @plugin 'tmux-plugins/tpm'
# https://github.com/catppuccin/tmux
set -g @plugin 'catppuccin/tmux#v2.1.3'
# https://github.com/tmux-plugins/tmux-battery
set -g @plugin 'tmux-plugins/tmux-battery'
# https://github.com/tmux-plugins/tmux-cpu
set -g @plugin 'tmux-plugins/tmux-cpu'
# https://github.com/tmux-plugins/tmux-online-status
#set -g @plugin 'tmux-plugins/tmux-online-status'

# =============================================================================
# THEME
# =============================================================================

# Config status bar 
set -g status on
set -g status-interval 3
set -g status-position bottom
set -g status-style "bg=#{@thm_bg}"
#set -g status-justify "absolute-centre"

# Config catppuccin
set -g @catppuccin_flavor "mocha"
set -g @catppuccin_status_background "#{@thm_bg}"
set -g @catppuccin_window_status_style "none"
set -g @catppuccin_pane_status_enabled "off"
set -g @catppuccin_pane_border_status "off"

# Config tmux-online-status
#set -g @online_icon "ok"

# Config tmux-cpu
set -g @cpu_percentage_format "%3.0f%%"
set -g @cpu_medium_thresh "35"
set -g @cpu_high_thresh "80"
set -g @cpu_low_fg_color "#[fg=#{@thm_teal}]"
set -g @cpu_medium_fg_color "#[fg=#{@thm_blue}]"
set -g @cpu_high_fg_color "#[fg=#{@thm_red}]#[REVERSE]"

set -g @ram_percentage_format "%3.0f%%"
set -g @ram_medium_thresh "35"
set -g @ram_high_thresh "80"
set -g @ram_low_fg_color "#[fg=#{@thm_teal}]"
set -g @ram_medium_fg_color "#[fg=#{@thm_blue}]"
set -g @ram_high_fg_color "#[fg=#{@thm_red}]#[REVERSE]"



# Status left style
set -g status-left-length 100
set -g status-left ""
set -ga status-left "#{?client_prefix,#{#[bg=#{@thm_red},fg=#{@thm_bg},bold]  #S },#{#[bg=#{@thm_bg},fg=#{@thm_green}]  #S }}"
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_overlay_0},none]│"
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_maroon}]  #{pane_current_command} "
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_overlay_0},none]│"
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_blue}]  #{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}} "
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_overlay_0},none]#{?window_zoomed_flag,│,}"
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_yellow}]#{?window_zoomed_flag,  zoom ,}"
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_overlay_0},none]│"

# status right style
set -g status-right-length 100
set -g status-right ""
set -ga status-right "#{cpu_fg_color}#[bg=#{@thm_bg}] CPU #{cpu_percentage} "
set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_overlay_0}, none]│"
set -ga status-right "#{ram_fg_color}#[bg=#{@thm_bg}] RAM #{ram_percentage} "
#set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_overlay_0}, none]│"
#set -ga status-right "#[bg=#{@thm_bg}]#{?#{==:#{online_status},ok},#[fg=#{@thm_blue}] 󰖩 ,#[fg=#{@thm_red},bold]#[REVERSE] 󰤮 }"
set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_overlay_0}, none]│"
set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_blue}] 󰭦 %Y-%m-%d 󰅐 %H:%M "
if 'test -r /sys/class/power_supply/BAT*' {
    set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_overlay_0}, none]│"
    set -ga status-right "#{battery_color_charge_fg}#[bg=#{@thm_bg}] #{battery_icon} #{battery_percentage} "
}

# Window 
set -wg automatic-rename on
set -g automatic-rename-format "Window"

set -g window-status-format " #I#{?#{!=:#{window_name},Window},: #W,} "
set -g window-status-style "bg=#{@thm_bg},fg=#{@thm_rosewater}"
set -g window-status-last-style "bg=#{@thm_bg},fg=#{@thm_peach}"
set -g window-status-activity-style "bg=#{@thm_red},fg=#{@thm_bg}"
set -g window-status-bell-style "bg=#{@thm_red},fg=#{@thm_bg},bold"
set -gF window-status-separator "#[bg=#{@thm_bg},fg=#{@thm_overlay_0},none]│"

set -g window-status-current-format " #I#{?#{!=:#{window_name},Window},: #W,} "
set -g window-status-current-style "bg=#{@thm_peach},fg=#{@thm_bg},bold"

# =============================================================================
# Init TPM (keep at bottom of conf)
# =============================================================================

run '~/.tmux/plugins/tpm/tpm'

